define(["jquery","core/notification","core/templates","tool_lp/dialogue","tool_lp/event_base","core/str","core/fragment"],function(a,b,c,d,e,f,g){var h=function(a,b,c){e.prototype.constructor.apply(this,[]),this._ratingOptions=a,this._showApplyGroup=b,this.contextid=c};return h.prototype=Object.create(e.prototype),h.prototype._popup=null,h.prototype._ratingOptions=null,h.prototype.contextid=null,h.prototype._afterRender=function(){var b=this._find('[data-action="rate"]'),c=this._find('[name="rating"]'),d=this._find('[name="applygroup"]');this._find('[data-action="cancel"]').click(function(a){a.preventDefault(),this._trigger("cancelled"),this.close()}.bind(this)),c.change(function(){var c=a(this);c.val()?b.prop("disabled",!1):b.prop("disabled",!0)}).change(),b.click(function(a){a.preventDefault();var b=c.val();if(b){var e=d.prop("checked");e!==!0&&(e=!1),this._trigger("rated",{rating:b,applygroup:e}),this.close()}}.bind(this))},h.prototype.close=function(){this._popup&&(this._popup.close(),this._popup=null)},h.prototype.display=function(){return this._render().then(function(a,b){return f.get_string("rate","tool_lp").then(function(e){this._popup=new d(e,a,this._afterRender.bind(this),this.close.bind(this),(!0)),c.runTemplateJS(b)}.bind(this))}.bind(this)).fail(b.exception)},h.prototype._find=function(b){return a(this._popup.getContent()).find(b)},h.prototype._render=function(){var a={};return a.canGrade=!!this._canGrade,a.ratingOptions=JSON.stringify(this._ratingOptions),a.showapplygroup=!!this._showApplyGroup,a.contextid=this.contextid,g.loadFragment("tool_cmcompetency","grade_cm",this.contextid,a)},h});