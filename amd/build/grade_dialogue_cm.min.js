/**
 * Grade dialogue for course modules.
 *
 * @module     report_cmcompetency/grade_dialogue_cm
 * @copyright  2019 Université de Montréal
 * @author     Marie-Eve Lévesque <marie-eve.levesque.8@umontreal.ca>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_cmcompetency/grade_dialogue_cm",["jquery","core/notification","core/templates","core/modal_factory","core/modal_events","tool_lp/event_base","core/str","core/fragment","core_form/events"],(function($,Notification,Templates,ModalFactory,ModalEvents,EventBase,Str,Fragment,FormEvents){var GradeCm=function(ratingOptions,showApplyGroup,contextid,trigger){EventBase.prototype.constructor.apply(this,[]),this._ratingOptions=ratingOptions,this._showApplyGroup=showApplyGroup,this.contextid=contextid,this.display($(trigger))};return(GradeCm.prototype=Object.create(EventBase.prototype)).modal=null,GradeCm.prototype._ratingOptions=null,GradeCm.prototype.contextid=null,GradeCm.prototype._afterRender=function(){var btnRate=this._find('[data-action="save"]'),lstRating=this._find('[name="rating"]'),applyGroup=this._find('[name="applygroup"]');this._find('[data-action="cancel"]').click(function(e){e.preventDefault(),this._trigger("cancelled")}.bind(this)),lstRating.change((function(){$(this).val()?btnRate.prop("disabled",!1):btnRate.prop("disabled",!0)})).change(),btnRate.click(function(e){e.preventDefault();var val=lstRating.val();if(val){var valgroup=applyGroup.prop("checked");!0!==valgroup&&(valgroup=!1),this._trigger("rated",{rating:val,applygroup:valgroup}),FormEvents.notifyFormSubmittedByJavascript(this.modal.getRoot().find("form")[0])}}.bind(this))},GradeCm.prototype.destroy=function(){this.modal.destroy()},GradeCm.prototype.display=function(trigger){return Str.get_string("rate","tool_lp").then(function(title){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:"",large:!0,buttons:{save:title}},trigger).done(function(modal){return this.modal=modal,this.modal.getRoot().on(ModalEvents.shown,function(){this.modal.setBody(this._render())}.bind(this)),this.modal.getRoot().on(ModalEvents.hidden,function(){this._trigger("popupdestroyed"),this.modal.destroy()}.bind(this)),this.modal.getRoot().on(ModalEvents.bodyRendered,function(){this.modal.getRoot().find("[data-groupname=buttonar]").addClass("hidden"),this._afterRender()}.bind(this)),this.modal}.bind(this))}.bind(this)).fail(Notification.exception)},GradeCm.prototype._find=function(selector){return this.modal.getRoot().find(selector)},GradeCm.prototype._render=function(){var args={};return args.canGrade=!!this._canGrade,args.ratingOptions=JSON.stringify(this._ratingOptions),args.showapplygroup=!!this._showApplyGroup,args.contextid=this.contextid,Fragment.loadFragment("tool_cmcompetency","grade_cm",this.contextid,args)},GradeCm}));

//# sourceMappingURL=grade_dialogue_cm.min.js.map