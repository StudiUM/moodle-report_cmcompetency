define(["jquery","core/notification","core/ajax","core/log","report_cmcompetency/grade_dialogue_cm","tool_lp/event_base","tool_lp/scalevalues"],function(a,b,c,d,e,f,g){var h=function(b,c,d,e,g,h,i,j){f.prototype.constructor.apply(this,[]);var k=a(b);if(!k.length)throw new Error("Could not find the trigger");this._scaleId=c,this._competencyId=d,this._userId=e,this._coursemoduleId=g,this._chooseStr=h,this._showApplyGroup=i,this.contextid=j,this._setUp(),k.click(function(a){a.preventDefault(),this._dialogue.display()}.bind(this)),this._methodName="tool_cmcompetency_grade_competency_in_coursemodule",this._args={competencyid:this._competencyId,cmid:this._coursemoduleId,userid:this._userId}};return h.prototype=Object.create(f.prototype),h.prototype._setUp=function(){var a=[],d=this,f=g.get_values(d._scaleId);f.done(function(f){a.push({value:"",name:d._chooseStr});for(var g=0;g<f.length;g++){var h=f[g];a.push({value:h.id,name:h.name})}d._dialogue=new e(a,d._showApplyGroup,d.contextid),d._dialogue.on("rated",function(a,e){var f=d._args;f.grade=e.rating,f.note=d._dialogue._find("form").serialize(),f.applygroup=e.applygroup,c.call([{methodname:d._methodName,args:f,done:function(a){d._trigger("competencyupdated",{args:f,evidence:a})},fail:b.exception}])})}).fail(b.exception)},h.prototype._scaleId=null,h.prototype._competencyId=null,h.prototype._userId=null,h.prototype._coursemoduleId=null,h.prototype._chooseStr=null,h.prototype._dialogue=null,h.prototype._showApplyGroup=!1,h.prototype.contextid=null,h});