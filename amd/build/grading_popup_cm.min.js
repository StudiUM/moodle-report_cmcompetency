define(["jquery","core/notification","core/str","core/ajax","core/log","core/templates","tool_lp/dialogue"],function(a,b,c,d,e,f,g){var h=function(b,c,d){this._regionSelector=b,this._userCompetencySelector=c,this.contextid=d,a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};return h.prototype._handleClick=function(c){var f=a(c.target).closest(this._userCompetencySelector),g=a(f).data("competencyid"),h=a(f).data("cmid"),i=a(f).data("userid");e.debug("Clicked on cell: competencyId="+g+", cmId="+h+", userId="+i);var j=d.call([{methodname:"tool_cmcompetency_data_for_user_competency_summary_in_coursemodule",args:{userid:i,competencyid:g,cmid:h}},{methodname:"tool_cmcompetency_user_competency_viewed_in_coursemodule",args:{userid:i,competencyid:g,cmid:h}}]);a.when.apply(a,j).then(function(a){this._contextLoaded.bind(this)(a)}.bind(this))["catch"](b.exception)},h.prototype._contextLoaded=function(a){var d=this;a.displayuser=!0,a.contextid=d.contextid,f.render("report_cmcompetency/user_competency_summary_in_coursemodule",a).done(function(a,e){c.get_string("usercompetencysummary","report_competency").done(function(b){d.popup=new g(b,a,f.runTemplateJS.bind(f,e),d._refresh.bind(d),(!0))}).fail(b.exception)}).fail(b.exception)},h.prototype._refresh=function(){var c=a(this._regionSelector),e=c.data("cmid"),f=c.data("userid");d.call([{methodname:"report_cmcompetency_data_for_report",args:{cmid:e,userid:f},done:this._pageContextLoaded.bind(this),fail:b.exception}])},h.prototype._pageContextLoaded=function(a){var c=this;a.contextid=c.contextid,f.render("report_cmcompetency/report",a).done(function(a,b){f.replaceNode(c._regionSelector,a,b)}).fail(b.exception),c.popup.close(),c.popup=null},h.prototype._regionSelector=null,h.prototype._userCompetencySelector=null,h.prototype.contextid=null,h.prototype.popup=null,h});