define ("report_cmcompetency/grading_popup_cm",["jquery","core/notification","core/str","core/ajax","core/log","core/templates","core/modal_factory","core/modal_events"],function(a,b,c,d,f,g,h,i){var j=function(b,c,d){this._regionSelector=b;this._userCompetencySelector=c;this.contextid=d;a(this._regionSelector).on("click",this._userCompetencySelector,this._handleClick.bind(this))};j.prototype._handleClick=function(c){var e=a(c.target).closest(this._userCompetencySelector),g=a(e).data("competencyid"),h=a(e).data("cmid"),i=a(e).data("userid");f.debug("Clicked on cell: competencyId="+g+", cmId="+h+", userId="+i);var j=d.call([{methodname:"tool_cmcompetency_data_for_user_competency_summary_in_coursemodule",args:{userid:i,competencyid:g,cmid:h}},{methodname:"tool_cmcompetency_user_competency_viewed_in_coursemodule",args:{userid:i,competencyid:g,cmid:h}}]);a.when.apply(a,j).then(function(a){this._contextLoaded.bind(this)(a,e)}.bind(this)).catch(b.exception)};j.prototype._contextLoaded=function(a,d){var e=this;a.displayuser=!0;a.contextid=e.contextid;return c.get_string("usercompetencysummary","report_competency").done(function(b){return h.create({type:h.types.DEFAULT,title:b,body:g.render("report_cmcompetency/user_competency_summary_in_coursemodule",a),large:!0},d).done(function(a){e.popup=a;e.popup.getRoot().on(i.hidden,e._refresh.bind(e));e.popup.show()}.bind(this))}).fail(b.exception)};j.prototype._refresh=function(){var c=a(this._regionSelector),e=c.data("cmid"),f=c.data("userid");this.popup.destroy();d.call([{methodname:"report_cmcompetency_data_for_report",args:{cmid:e,userid:f},done:this._pageContextLoaded.bind(this),fail:b.exception}])};j.prototype._pageContextLoaded=function(a){var c=this;a.contextid=c.contextid;g.render("report_cmcompetency/report",a).done(function(a,b){g.replaceNode(c._regionSelector,a,b)}).fail(b.exception)};j.prototype._regionSelector=null;j.prototype._userCompetencySelector=null;j.prototype.contextid=null;j.prototype.popup=null;return j});
//# sourceMappingURL=grading_popup_cm.min.js.map
